(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,7233,e=>{"use strict";let t=(0,e.i(75254).default)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);e.s(["Plus",()=>t],7233)},13238,e=>{"use strict";e.i(47167);var t=e.i(43476),a=e.i(71645),s=e.i(18566),r=e.i(11795);let l=(0,e.i(75254).default)("minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);var n=e.i(7233),i=e.i(37727);let o=(0,a.memo)(function({isOpen:e,onConfirm:s}){let r=(0,a.useRef)(null),l=(0,a.useRef)(null);return((0,a.useEffect)(()=>{e&&setTimeout(()=>{r.current?.focus()},50)},[e]),e)?(0,t.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",style:{pointerEvents:"auto"},children:(0,t.jsxs)("div",{className:"bg-white rounded-2xl p-6 w-full max-w-md",style:{pointerEvents:"auto"},children:[(0,t.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-5",children:"Informasi Anda"}),(0,t.jsx)("label",{className:"block text-xs font-semibold text-gray-600 mb-2",children:"Nama *"}),(0,t.jsx)("input",{ref:r,type:"text",autoComplete:"off",inputMode:"text",className:"w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl mb-4",placeholder:"Masukkan nama",defaultValue:""}),(0,t.jsx)("label",{className:"block text-xs font-semibold text-gray-600 mb-2",children:"Nomor Telepon (Opsional)"}),(0,t.jsx)("input",{ref:l,type:"tel",autoComplete:"off",inputMode:"tel",className:"w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl mb-4",placeholder:"Masukkan nomor telepon",defaultValue:""}),(0,t.jsx)("button",{type:"button",onClick:()=>{let e=r.current?.value.trim()||"",t=l.current?.value.trim()||"";if(!e){alert("Nama tidak boleh kosong"),r.current?.focus();return}s(e,t)},className:"w-full bg-red-500 text-white py-3.5 rounded-xl font-bold",children:"Lanjutkan"})]})}):null});function d(){let e=(0,s.useParams)();(0,s.useRouter)();let d=e.tableBarcode,[c,m]=(0,a.useState)(null),[u,x]=(0,a.useState)(null),[b,h]=(0,a.useState)([]),[y,p]=(0,a.useState)(["All"]),[f,g]=(0,a.useState)("All"),[j,N]=(0,a.useState)(!0),[w,v]=(0,a.useState)([]),[k,C]=(0,a.useState)(!1),[I,S]=(0,a.useState)(!1),[_,q]=(0,a.useState)(""),[T,M]=(0,a.useState)(""),[E,P]=(0,a.useState)(!0),z=u?.primary_color||"#EF4444";(0,a.useEffect)(()=>{A()},[d]);let A=async()=>{try{N(!0);let e=(0,r.createClient)();if(!d)throw Error("Invalid table barcode");let{data:t,error:a}=await e.from("tables").select("id, number, restaurant_id").eq("barcode",d).single();if(a||!t)throw Error("Table not found");m(t);let{data:s}=await e.from("restaurants").select("id, name, logo_url, primary_color").eq("id",t.restaurant_id).single();s&&x(s);let{data:l,error:n}=await e.from("menu_items").select(`
          id,
          name,
          category,
          price,
          menu_categories(id, name, parent_id)
        `).eq("restaurant_id",t.restaurant_id).eq("available",!0).order("name");if(n)throw n;let i=(l||[]).map(e=>({...e,menu_category:e.menu_category||e.menu_categories||null}));h(i);let o=new Set;o.add("All"),i.forEach(e=>{e.menu_category?o.add(e.menu_category.name):e.category&&o.add(e.category)}),p(Array.from(o))}catch(e){console.error("Error loading table/menu:",e),alert(e.message||"Failed to load table")}finally{N(!1)}},O="All"===f?b:b.filter(e=>e.menu_category?e.menu_category.name===f:e.category===f),R=(e,t)=>{if(t<=0)v(w.filter(t=>t.id!==e));else v(w.map(a=>a.id===e?{...a,quantity:t}:a))},J=w.reduce((e,t)=>e+t.price*t.quantity,0),B=async()=>{if(!_.trim())return void alert("Masukkan nama Anda");if(0===w.length)return void alert("Pilih minimal satu item");if(!c)return void alert("Meja tidak ditemukan");S(!0);try{let e=(0,r.createClient)(),{data:{session:t}}=await e.auth.getSession(),a=t?.access_token?`Bearer ${t.access_token}`:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJpZ2psenJubHpjZnh3bGtzdHBwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI3MTMxNTQsImV4cCI6MjA3ODI4OTE1NH0.TL7-xrvu1FHwawVaW3XhTztPO37v45Uq9v-kQKFRev0";if(!(await fetch("https://bigjlzrnlzcfxwlkstpp.supabase.co/functions/v1/restaurant-api/orders",{method:"POST",headers:{"Content-Type":"application/json",Authorization:a},body:JSON.stringify({tableId:c.id,restaurantId:c.restaurant_id,customerName:_.trim(),items:w.map(e=>({menuId:e.id,name:e.name,quantity:e.quantity,price:e.price,category:e.category,note:e.note||""}))})})).ok)throw Error("Failed to submit order");v([]),C(!1),alert("✅ Pesanan Diterima\n\nPesanan Anda sudah dikirim ke dapur. Terima kasih!"),q(""),M("")}catch(e){console.error("Error submitting order:",e),alert(e.message||"Gagal mengirim pesanan")}finally{S(!1)}};return j?(0,t.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 mx-auto",style:{borderColor:z}}),(0,t.jsx)("p",{className:"mt-4 text-gray-600",children:"Memuat menu..."})]})}):(0,t.jsxs)("div",{className:"min-h-screen bg-gray-50 pb-24",children:[(0,t.jsx)("div",{className:"bg-white border-b border-gray-200 sticky top-0 z-10 shadow-sm",children:(0,t.jsxs)("div",{className:"px-4 py-4 flex flex-col items-center justify-center",children:[u?.logo_url?(0,t.jsx)("img",{src:u.logo_url,alt:u.name,className:"h-12 w-auto object-contain mb-2"}):(0,t.jsx)("h1",{className:"text-xl font-bold text-gray-900 mb-1",children:u?.name||"Menu"}),(0,t.jsxs)("p",{className:"text-xs font-medium text-gray-500 bg-gray-100 px-3 py-1 rounded-full",children:["Meja ",c?.number]})]})}),_&&(0,t.jsxs)("div",{className:"bg-white m-4 rounded-xl p-4 border border-gray-200 shadow-sm",children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-gray-600 mb-1",children:"Nama Pemesan"}),(0,t.jsx)("p",{className:"text-base font-semibold text-gray-900 mb-3",children:_}),T&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)("p",{className:"text-xs font-semibold text-gray-600 mb-1",children:"Nomor Telepon"}),(0,t.jsx)("p",{className:"text-base font-semibold text-gray-900 mb-3",children:T})]}),(0,t.jsx)("button",{onClick:()=>P(!0),className:"font-semibold text-sm",style:{color:z},children:"✏️ Ubah"})]}),(0,t.jsxs)("div",{className:"bg-white border-b border-gray-200 px-4 py-3 sticky top-[89px] z-10 shadow-sm",children:[(0,t.jsx)("p",{className:"text-xs font-bold text-gray-500 uppercase tracking-wide mb-3",children:"Kategori"}),(0,t.jsx)("div",{className:"flex gap-2 overflow-x-auto pb-2 no-scrollbar",children:y.map(e=>(0,t.jsx)("button",{onClick:()=>g(e),className:"px-4 py-2.5 rounded-full text-sm font-bold whitespace-nowrap border-2 min-w-[100px] transition-colors",style:{backgroundColor:f===e?z:"white",borderColor:f===e?z:"#E5E7EB",color:f===e?"white":"#4B5563"},children:"All"===e?"Semua":e},e))})]}),(0,t.jsx)("div",{className:"px-3 py-2",children:O.map(e=>{let a=w.find(t=>t.id===e.id);return(0,t.jsxs)("div",{className:`flex items-center bg-white mx-2 my-3 p-3.5 rounded-xl border shadow-sm ${a?"bg-gray-50 border-gray-300":"border-gray-200"}`,children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("h3",{className:"text-base font-bold text-gray-900",children:e.name}),(0,t.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:e.menu_category?.name||e.category}),(0,t.jsxs)("p",{className:"text-base font-bold text-gray-900 mt-1",children:["Rp",e.price.toLocaleString("id-ID")]})]}),(0,t.jsx)("button",{onClick:()=>{w.find(t=>t.id===e.id)?v(w.map(t=>t.id===e.id?{...t,quantity:t.quantity+1}:t)):v([...w,{...e,quantity:1}])},className:"w-10 h-10 bg-white border border-gray-200 rounded-lg flex items-center justify-center ml-3 shadow-sm active:scale-95 transition-transform",children:(0,t.jsx)(n.Plus,{className:"w-5 h-5",style:{color:z}})})]},e.id)})}),w.length>0&&(0,t.jsxs)("button",{onClick:()=>C(!0),className:"fixed bottom-5 left-4 right-4 text-white py-4 rounded-2xl shadow-xl flex items-center justify-center active:scale-95 transition-transform z-40",style:{backgroundColor:z},children:[(0,t.jsx)("div",{className:"absolute left-4 w-8 h-8 bg-white rounded-full flex items-center justify-center",children:(0,t.jsx)("span",{className:"text-sm font-extrabold",style:{color:z},children:w.reduce((e,t)=>e+t.quantity,0)})}),(0,t.jsxs)("span",{className:"text-base font-bold",children:["Lihat Pesanan • Rp",w.reduce((e,t)=>e+t.price*t.quantity,0).toLocaleString("id-ID")]})]}),(0,t.jsx)(o,{isOpen:E,onConfirm:(e,t)=>{q(e),M(t),P(!1)}}),k&&(0,t.jsxs)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-end z-50",children:[(0,t.jsx)("div",{className:"absolute inset-0",onClick:()=>C(!1)}),(0,t.jsxs)("div",{className:"bg-white rounded-t-[40px] w-full max-h-[90vh] flex flex-col relative",children:[(0,t.jsx)("div",{className:"w-8 h-1 bg-gray-300 rounded-full mx-auto mt-2 mb-2"}),(0,t.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-200",children:[(0,t.jsx)("h2",{className:"text-2xl font-extrabold text-gray-900",children:"Pesanan"}),(0,t.jsx)("button",{onClick:()=>C(!1),children:(0,t.jsx)(i.X,{className:"w-6 h-6 text-gray-500"})})]}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto px-6 py-5",children:w.map(e=>(0,t.jsxs)("div",{className:"mb-6 pb-6 border-b border-gray-200",children:[(0,t.jsxs)("div",{className:"flex justify-between items-start mb-3",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("h3",{className:"text-base font-normal text-gray-900",children:e.name}),(0,t.jsxs)("p",{className:"text-sm text-gray-500",children:["Rp",e.price.toLocaleString("id-ID")]})]}),(0,t.jsxs)("p",{className:"text-base font-semibold text-gray-900",children:["Rp",(e.price*e.quantity).toLocaleString("id-ID")]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,t.jsx)("button",{onClick:()=>R(e.id,e.quantity-1),className:"w-10 h-10 bg-gray-50 border border-gray-200 rounded-xl flex items-center justify-center",children:(0,t.jsx)(l,{className:"w-4 h-4",style:{color:z}})}),(0,t.jsx)("span",{className:"text-base text-gray-900 min-w-[32px] text-center",children:e.quantity}),(0,t.jsx)("button",{onClick:()=>R(e.id,e.quantity+1),className:"w-10 h-10 bg-gray-50 border border-gray-200 rounded-xl flex items-center justify-center",children:(0,t.jsx)(n.Plus,{className:"w-4 h-4",style:{color:z}})})]}),(0,t.jsx)("textarea",{className:"w-full px-3 py-2.5 bg-white border border-gray-300 rounded-lg text-sm resize-none focus:ring-2 focus:outline-none",style:{"--tw-ring-color":z},placeholder:"Tambahkan catatan (contoh: tanpa gula)...",value:e.note||"",onChange:t=>{var a,s;return a=e.id,s=t.target.value,void v(w.map(e=>e.id===a?{...e,note:s}:e))},rows:2})]},e.id))}),(0,t.jsxs)("div",{className:"px-6 pt-5 pb-6 border-t border-gray-200 bg-white",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,t.jsx)("span",{className:"text-base font-semibold text-gray-900",children:"Total"}),(0,t.jsxs)("span",{className:"text-lg font-semibold text-gray-900",children:["Rp",J.toLocaleString("id-ID")]})]}),(0,t.jsx)("button",{onClick:B,disabled:I,className:`w-full text-white py-4 rounded-full font-semibold ${I?"opacity-50":""}`,style:{backgroundColor:z},children:I?"Mengirim...":"Konfirmasi Pesanan"})]})]})]})]})}e.s(["default",()=>d],13238)}]);