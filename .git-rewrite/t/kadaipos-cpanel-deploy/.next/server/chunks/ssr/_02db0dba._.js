module.exports=[15618,a=>{"use strict";let b=(0,a.i(70106).default)("plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);a.s(["Plus",()=>b],15618)},38087,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(95445);let f=(0,a.i(70106).default)("minus",[["path",{d:"M5 12h14",key:"1ays0h"}]]);var g=a.i(15618),h=a.i(33508);let i=(0,c.memo)(function({isOpen:a,onConfirm:d}){let e=(0,c.useRef)(null),f=(0,c.useRef)(null);return((0,c.useEffect)(()=>{a&&setTimeout(()=>{e.current?.focus()},50)},[a]),a)?(0,b.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4",style:{pointerEvents:"auto"},children:(0,b.jsxs)("div",{className:"bg-white rounded-2xl p-6 w-full max-w-md",style:{pointerEvents:"auto"},children:[(0,b.jsx)("h2",{className:"text-xl font-bold text-gray-900 mb-5",children:"Informasi Anda"}),(0,b.jsx)("label",{className:"block text-xs font-semibold text-gray-600 mb-2",children:"Nama *"}),(0,b.jsx)("input",{ref:e,type:"text",autoComplete:"off",inputMode:"text",className:"w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl mb-4",placeholder:"Masukkan nama",defaultValue:""}),(0,b.jsx)("label",{className:"block text-xs font-semibold text-gray-600 mb-2",children:"Nomor Telepon (Opsional)"}),(0,b.jsx)("input",{ref:f,type:"tel",autoComplete:"off",inputMode:"tel",className:"w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl mb-4",placeholder:"Masukkan nomor telepon",defaultValue:""}),(0,b.jsx)("button",{type:"button",onClick:()=>{let a=e.current?.value.trim()||"",b=f.current?.value.trim()||"";if(!a){alert("Nama tidak boleh kosong"),e.current?.focus();return}d(a,b)},className:"w-full bg-red-500 text-white py-3.5 rounded-xl font-bold",children:"Lanjutkan"})]})}):null});function j(){let a=(0,d.useParams)();(0,d.useRouter)();let j=a.tableBarcode,[k,l]=(0,c.useState)(null),[m,n]=(0,c.useState)(null),[o,p]=(0,c.useState)([]),[q,r]=(0,c.useState)(["All"]),[s,t]=(0,c.useState)("All"),[u,v]=(0,c.useState)(!0),[w,x]=(0,c.useState)([]),[y,z]=(0,c.useState)(!1),[A,B]=(0,c.useState)(!1),[C,D]=(0,c.useState)(""),[E,F]=(0,c.useState)(""),[G,H]=(0,c.useState)(!0),I=m?.primary_color||"#EF4444";(0,c.useEffect)(()=>{J()},[j]);let J=async()=>{try{v(!0);let a=(0,e.createClient)();if(!j)throw Error("Invalid table barcode");let{data:b,error:c}=await a.from("tables").select("id, number, restaurant_id").eq("barcode",j).single();if(c||!b)throw Error("Table not found");l(b);let{data:d}=await a.from("restaurants").select("id, name, logo_url, primary_color").eq("id",b.restaurant_id).single();d&&n(d);let{data:f,error:g}=await a.from("menu_items").select(`
          id,
          name,
          category,
          price,
          menu_categories(id, name, parent_id)
        `).eq("restaurant_id",b.restaurant_id).eq("available",!0).order("name");if(g)throw g;let h=(f||[]).map(a=>({...a,menu_category:a.menu_category||a.menu_categories||null}));p(h);let i=new Set;i.add("All"),h.forEach(a=>{a.menu_category?i.add(a.menu_category.name):a.category&&i.add(a.category)}),r(Array.from(i))}catch(a){console.error("Error loading table/menu:",a),alert(a.message||"Failed to load table")}finally{v(!1)}},K="All"===s?o:o.filter(a=>a.menu_category?a.menu_category.name===s:a.category===s),L=(a,b)=>{if(b<=0)x(w.filter(b=>b.id!==a));else x(w.map(c=>c.id===a?{...c,quantity:b}:c))},M=w.reduce((a,b)=>a+b.price*b.quantity,0),N=async()=>{if(!C.trim())return void alert("Masukkan nama Anda");if(0===w.length)return void alert("Pilih minimal satu item");if(!k)return void alert("Meja tidak ditemukan");B(!0);try{let a=(0,e.createClient)(),{data:{session:b}}=await a.auth.getSession(),c=b?.access_token?`Bearer ${b.access_token}`:"Bearer eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImJpZ2psenJubHpjZnh3bGtzdHBwIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjI3MTMxNTQsImV4cCI6MjA3ODI4OTE1NH0.TL7-xrvu1FHwawVaW3XhTztPO37v45Uq9v-kQKFRev0";if(!(await fetch("https://bigjlzrnlzcfxwlkstpp.supabase.co/functions/v1/restaurant-api/orders",{method:"POST",headers:{"Content-Type":"application/json",Authorization:c},body:JSON.stringify({tableId:k.id,restaurantId:k.restaurant_id,customerName:C.trim(),items:w.map(a=>({menuId:a.id,name:a.name,quantity:a.quantity,price:a.price,category:a.category,note:a.note||""}))})})).ok)throw Error("Failed to submit order");x([]),z(!1),alert("✅ Pesanan Diterima\n\nPesanan Anda sudah dikirim ke dapur. Terima kasih!"),D(""),F("")}catch(a){console.error("Error submitting order:",a),alert(a.message||"Gagal mengirim pesanan")}finally{B(!1)}};return u?(0,b.jsx)("div",{className:"min-h-screen bg-gray-50 flex items-center justify-center",children:(0,b.jsxs)("div",{className:"text-center",children:[(0,b.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 mx-auto",style:{borderColor:I}}),(0,b.jsx)("p",{className:"mt-4 text-gray-600",children:"Memuat menu..."})]})}):(0,b.jsxs)("div",{className:"min-h-screen bg-gray-50 pb-24",children:[(0,b.jsx)("div",{className:"bg-white border-b border-gray-200 sticky top-0 z-10 shadow-sm",children:(0,b.jsxs)("div",{className:"px-4 py-4 flex flex-col items-center justify-center",children:[m?.logo_url?(0,b.jsx)("img",{src:m.logo_url,alt:m.name,className:"h-12 w-auto object-contain mb-2"}):(0,b.jsx)("h1",{className:"text-xl font-bold text-gray-900 mb-1",children:m?.name||"Menu"}),(0,b.jsxs)("p",{className:"text-xs font-medium text-gray-500 bg-gray-100 px-3 py-1 rounded-full",children:["Meja ",k?.number]})]})}),C&&(0,b.jsxs)("div",{className:"bg-white m-4 rounded-xl p-4 border border-gray-200 shadow-sm",children:[(0,b.jsx)("p",{className:"text-xs font-semibold text-gray-600 mb-1",children:"Nama Pemesan"}),(0,b.jsx)("p",{className:"text-base font-semibold text-gray-900 mb-3",children:C}),E&&(0,b.jsxs)(b.Fragment,{children:[(0,b.jsx)("p",{className:"text-xs font-semibold text-gray-600 mb-1",children:"Nomor Telepon"}),(0,b.jsx)("p",{className:"text-base font-semibold text-gray-900 mb-3",children:E})]}),(0,b.jsx)("button",{onClick:()=>H(!0),className:"font-semibold text-sm",style:{color:I},children:"✏️ Ubah"})]}),(0,b.jsxs)("div",{className:"bg-white border-b border-gray-200 px-4 py-3 sticky top-[89px] z-10 shadow-sm",children:[(0,b.jsx)("p",{className:"text-xs font-bold text-gray-500 uppercase tracking-wide mb-3",children:"Kategori"}),(0,b.jsx)("div",{className:"flex gap-2 overflow-x-auto pb-2 no-scrollbar",children:q.map(a=>(0,b.jsx)("button",{onClick:()=>t(a),className:"px-4 py-2.5 rounded-full text-sm font-bold whitespace-nowrap border-2 min-w-[100px] transition-colors",style:{backgroundColor:s===a?I:"white",borderColor:s===a?I:"#E5E7EB",color:s===a?"white":"#4B5563"},children:"All"===a?"Semua":a},a))})]}),(0,b.jsx)("div",{className:"px-3 py-2",children:K.map(a=>{let c=w.find(b=>b.id===a.id);return(0,b.jsxs)("div",{className:`flex items-center bg-white mx-2 my-3 p-3.5 rounded-xl border shadow-sm ${c?"bg-gray-50 border-gray-300":"border-gray-200"}`,children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("h3",{className:"text-base font-bold text-gray-900",children:a.name}),(0,b.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:a.menu_category?.name||a.category}),(0,b.jsxs)("p",{className:"text-base font-bold text-gray-900 mt-1",children:["Rp",a.price.toLocaleString("id-ID")]})]}),(0,b.jsx)("button",{onClick:()=>{w.find(b=>b.id===a.id)?x(w.map(b=>b.id===a.id?{...b,quantity:b.quantity+1}:b)):x([...w,{...a,quantity:1}])},className:"w-10 h-10 bg-white border border-gray-200 rounded-lg flex items-center justify-center ml-3 shadow-sm active:scale-95 transition-transform",children:(0,b.jsx)(g.Plus,{className:"w-5 h-5",style:{color:I}})})]},a.id)})}),w.length>0&&(0,b.jsxs)("button",{onClick:()=>z(!0),className:"fixed bottom-5 left-4 right-4 text-white py-4 rounded-2xl shadow-xl flex items-center justify-center active:scale-95 transition-transform z-40",style:{backgroundColor:I},children:[(0,b.jsx)("div",{className:"absolute left-4 w-8 h-8 bg-white rounded-full flex items-center justify-center",children:(0,b.jsx)("span",{className:"text-sm font-extrabold",style:{color:I},children:w.reduce((a,b)=>a+b.quantity,0)})}),(0,b.jsxs)("span",{className:"text-base font-bold",children:["Lihat Pesanan • Rp",w.reduce((a,b)=>a+b.price*b.quantity,0).toLocaleString("id-ID")]})]}),(0,b.jsx)(i,{isOpen:G,onConfirm:(a,b)=>{D(a),F(b),H(!1)}}),y&&(0,b.jsxs)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-end z-50",children:[(0,b.jsx)("div",{className:"absolute inset-0",onClick:()=>z(!1)}),(0,b.jsxs)("div",{className:"bg-white rounded-t-[40px] w-full max-h-[90vh] flex flex-col relative",children:[(0,b.jsx)("div",{className:"w-8 h-1 bg-gray-300 rounded-full mx-auto mt-2 mb-2"}),(0,b.jsxs)("div",{className:"flex items-center justify-between px-6 py-4 border-b border-gray-200",children:[(0,b.jsx)("h2",{className:"text-2xl font-extrabold text-gray-900",children:"Pesanan"}),(0,b.jsx)("button",{onClick:()=>z(!1),children:(0,b.jsx)(h.X,{className:"w-6 h-6 text-gray-500"})})]}),(0,b.jsx)("div",{className:"flex-1 overflow-y-auto px-6 py-5",children:w.map(a=>(0,b.jsxs)("div",{className:"mb-6 pb-6 border-b border-gray-200",children:[(0,b.jsxs)("div",{className:"flex justify-between items-start mb-3",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("h3",{className:"text-base font-normal text-gray-900",children:a.name}),(0,b.jsxs)("p",{className:"text-sm text-gray-500",children:["Rp",a.price.toLocaleString("id-ID")]})]}),(0,b.jsxs)("p",{className:"text-base font-semibold text-gray-900",children:["Rp",(a.price*a.quantity).toLocaleString("id-ID")]})]}),(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-3",children:[(0,b.jsx)("button",{onClick:()=>L(a.id,a.quantity-1),className:"w-10 h-10 bg-gray-50 border border-gray-200 rounded-xl flex items-center justify-center",children:(0,b.jsx)(f,{className:"w-4 h-4",style:{color:I}})}),(0,b.jsx)("span",{className:"text-base text-gray-900 min-w-[32px] text-center",children:a.quantity}),(0,b.jsx)("button",{onClick:()=>L(a.id,a.quantity+1),className:"w-10 h-10 bg-gray-50 border border-gray-200 rounded-xl flex items-center justify-center",children:(0,b.jsx)(g.Plus,{className:"w-4 h-4",style:{color:I}})})]}),(0,b.jsx)("textarea",{className:"w-full px-3 py-2.5 bg-white border border-gray-300 rounded-lg text-sm resize-none focus:ring-2 focus:outline-none",style:{"--tw-ring-color":I},placeholder:"Tambahkan catatan (contoh: tanpa gula)...",value:a.note||"",onChange:b=>{var c,d;return c=a.id,d=b.target.value,void x(w.map(a=>a.id===c?{...a,note:d}:a))},rows:2})]},a.id))}),(0,b.jsxs)("div",{className:"px-6 pt-5 pb-6 border-t border-gray-200 bg-white",children:[(0,b.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,b.jsx)("span",{className:"text-base font-semibold text-gray-900",children:"Total"}),(0,b.jsxs)("span",{className:"text-lg font-semibold text-gray-900",children:["Rp",M.toLocaleString("id-ID")]})]}),(0,b.jsx)("button",{onClick:N,disabled:A,className:`w-full text-white py-4 rounded-full font-semibold ${A?"opacity-50":""}`,style:{backgroundColor:I},children:A?"Mengirim...":"Konfirmasi Pesanan"})]})]})]})]})}a.s(["default",()=>j],38087)}];

//# sourceMappingURL=_02db0dba._.js.map