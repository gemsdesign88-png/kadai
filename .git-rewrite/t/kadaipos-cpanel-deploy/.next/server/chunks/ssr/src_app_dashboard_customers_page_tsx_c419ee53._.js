module.exports=[63910,a=>{"use strict";var b=a.i(87924),c=a.i(72131),d=a.i(50944),e=a.i(95445),f=a.i(60246),g=a.i(24669),h=a.i(93518),i=a.i(41675),j=a.i(90166),k=a.i(38784),l=a.i(33508),m=a.i(21979);function n(){let a=(0,d.useRouter)(),n=(0,e.createClient)(),{language:o}=(0,m.useLanguage)(),[p,q]=(0,c.useState)(!0),[r,s]=(0,c.useState)(null),[t,u]=(0,c.useState)({totalCustomers:0,activeCustomers:0,totalRevenue:0,avgOrderValue:0,repeatingCustomers:0,repeatingRate:0}),[v,w]=(0,c.useState)([]),[x,y]=(0,c.useState)([]),[z,A]=(0,c.useState)([]),[B,C]=(0,c.useState)([]),[D,E]=(0,c.useState)(!1),[F,G]=(0,c.useState)("all");async function H(){if(r){q(!0);try{let a=new Date,b=new Date(a);b.setDate(a.getDate()-30);let{data:c}=await n.from("orders").select("*, order_items(*)").eq("restaurant_id",r.id).eq("payment_status","paid").gte("paid_at",b.toISOString());if(!c)return void q(!1);let d=new Set(c.map(a=>a.customer_id||a.id)).size,e=new Date(a);e.setDate(a.getDate()-7);let f=c.filter(a=>new Date(a.paid_at)>=e),g=new Set(f.map(a=>a.customer_id||a.id)).size,h={};c.forEach(a=>{let b=a.customer_id||a.id,c=a.customer_name?.trim()||`Customer ${b?.substring(0,8)}`;h[b]||(h[b]={id:a.id,customerId:b,customerName:c,totalOrders:0,totalSpent:0,lastOrder:a.paid_at,items:[]}),a.customer_name?.trim()&&!h[b].customerName.startsWith("Customer ")&&(h[b].customerName=a.customer_name.trim()),h[b].totalOrders+=1,h[b].totalSpent+=a.total||0,h[b].lastOrder=new Date(a.paid_at)>new Date(h[b].lastOrder)?a.paid_at:h[b].lastOrder,a.order_items?.forEach(a=>{let c=a.item_name||a.name;h[b].items.push(c)})});let i=Object.values(h).reduce((a,b)=>a+b.totalSpent,0),j=i/c.length,k=Object.values(h).filter(a=>a.totalOrders>1).length,l=d>0?k/d*100:0,m=Object.values(h).map(a=>({id:a.id,customerId:a.customerId,customerName:a.customerName,totalOrders:a.totalOrders,totalSpent:a.totalSpent,lastOrder:a.lastOrder,avgOrderValue:a.totalSpent/a.totalOrders,favoriteItem:I(a.items)})).sort((a,b)=>b.totalSpent-a.totalSpent).slice(0,5),o=Object.values(h).filter(a=>new Date(a.lastOrder)>=e).sort((a,b)=>new Date(b.lastOrder).getTime()-new Date(a.lastOrder).getTime()).slice(0,5).map(a=>({id:a.id,customerId:a.customerId,customerName:a.customerName,totalOrders:a.totalOrders,totalSpent:a.totalSpent,lastOrder:a.lastOrder,avgOrderValue:a.totalSpent/a.totalOrders,favoriteItem:I(a.items)})),p=Object.values(h).filter(a=>a.totalOrders>=3).sort((a,b)=>b.totalOrders-a.totalOrders).map(a=>({id:a.id,customerId:a.customerId,customerName:a.customerName,totalOrders:a.totalOrders,totalSpent:a.totalSpent,lastOrder:a.lastOrder,avgOrderValue:a.totalSpent/a.totalOrders,favoriteItem:I(a.items)})),s=Object.values(h).map(a=>({id:a.id,customerId:a.customerId,customerName:a.customerName,totalOrders:a.totalOrders,totalSpent:a.totalSpent,lastOrder:a.lastOrder,avgOrderValue:a.totalSpent/a.totalOrders,favoriteItem:I(a.items)})).sort((a,b)=>b.totalSpent-a.totalSpent);u({totalCustomers:d,activeCustomers:g,totalRevenue:i,avgOrderValue:Math.round(j),repeatingCustomers:k,repeatingRate:Math.round(l)}),w(m),y(o),A(p.slice(0,5)),C(s)}catch(a){console.error("Error loading customer data:",a)}finally{q(!1)}}}function I(a){if(0===a.length)return"-";let b={};return a.forEach(a=>{b[a]=(b[a]||0)+1}),Object.entries(b).sort((a,b)=>b[1]-a[1])[0][0]}function J(a){return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(a)}function K(a){return new Date(a).toLocaleDateString("en"===o?"en-US":"id-ID")}return(0,c.useEffect)(()=>{!async function(){let{data:{user:b}}=await n.auth.getUser();if(!b)return a.push("/login");let{data:c}=await n.from("restaurants").select("*").eq("owner_id",b.id);if(!c||0===c.length)return a.push("/dashboard");let d=localStorage.getItem("selected_restaurant_id");if(d){let a=c.find(a=>a.id===d);a?s(a):s(c[0])}else s(c[0])}()},[]),(0,c.useEffect)(()=>{r&&H()},[r]),(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"p-8 mb-8 flex items-center justify-between",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"en"===o?"Customers":"Pelanggan"}),(0,b.jsx)("p",{className:"text-gray-600",children:"en"===o?"Customer insights and analytics":"Wawasan dan analitik pelanggan"})]}),(0,b.jsxs)("button",{onClick:()=>E(!0),className:"flex items-center gap-2 px-6 py-3 bg-[var(--color-accent)] text-white rounded-xl font-semibold hover:bg-[var(--color-accent-hover)] transition-colors",children:[(0,b.jsx)(f.Users,{className:"w-5 h-5"}),"en"===o?"View All Customers":"Lihat Semua Pelanggan"]})]}),(0,b.jsx)("main",{className:"px-8 pb-8",children:p?(0,b.jsx)("div",{className:"flex items-center justify-center py-20",children:(0,b.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[var(--color-accent)]"})}):(0,b.jsxs)(b.Fragment,{children:[(0,b.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-8",children:[(0,b.jsxs)("div",{className:"bg-white rounded-xl p-5 border border-gray-100 shadow-sm",children:[(0,b.jsx)("div",{className:"flex items-center justify-between mb-3",children:(0,b.jsx)(f.Users,{className:"w-5 h-5 text-blue-600"})}),(0,b.jsx)("p",{className:"text-xs text-gray-600 mb-1",children:"en"===o?"Total Customers":"Total Pelanggan"}),(0,b.jsx)("h3",{className:"text-2xl font-bold text-gray-900",children:t.totalCustomers})]}),(0,b.jsxs)("div",{className:"bg-white rounded-xl p-5 border border-gray-100 shadow-sm",children:[(0,b.jsx)("div",{className:"flex items-center justify-between mb-3",children:(0,b.jsx)(g.TrendingUp,{className:"w-5 h-5 text-green-600"})}),(0,b.jsx)("p",{className:"text-xs text-gray-600 mb-1",children:"en"===o?"Active (7 Days)":"Aktif (7 Hari)"}),(0,b.jsx)("h3",{className:"text-2xl font-bold text-gray-900",children:t.activeCustomers})]}),(0,b.jsxs)("div",{className:"bg-white rounded-xl p-5 border border-gray-100 shadow-sm",children:[(0,b.jsx)("div",{className:"flex items-center justify-between mb-3",children:(0,b.jsx)(h.Award,{className:"w-5 h-5 text-purple-600"})}),(0,b.jsx)("p",{className:"text-xs text-gray-600 mb-1",children:"en"===o?"Loyal Customers":"Pelanggan Setia"}),(0,b.jsx)("h3",{className:"text-2xl font-bold text-gray-900",children:t.repeatingCustomers})]}),(0,b.jsxs)("div",{className:"bg-white rounded-xl p-5 border border-gray-100 shadow-sm",children:[(0,b.jsx)("div",{className:"flex items-center justify-between mb-3",children:(0,b.jsx)(k.ShoppingCart,{className:"w-5 h-5 text-orange-600"})}),(0,b.jsx)("p",{className:"text-xs text-gray-600 mb-1",children:"en"===o?"Loyalty Rate":"Tingkat Loyalitas"}),(0,b.jsxs)("h3",{className:"text-2xl font-bold text-gray-900",children:[t.repeatingRate,"%"]})]}),(0,b.jsxs)("div",{className:"bg-white rounded-xl p-5 border border-gray-100 shadow-sm",children:[(0,b.jsx)("div",{className:"flex items-center justify-between mb-3",children:(0,b.jsx)(j.DollarSign,{className:"w-5 h-5 text-green-600"})}),(0,b.jsx)("p",{className:"text-xs text-gray-600 mb-1",children:"en"===o?"Total Revenue":"Total Pendapatan"}),(0,b.jsx)("h3",{className:"text-xl font-bold text-gray-900",children:J(t.totalRevenue).substring(0,15)})]}),(0,b.jsxs)("div",{className:"bg-white rounded-xl p-5 border border-gray-100 shadow-sm",children:[(0,b.jsx)("div",{className:"flex items-center justify-between mb-3",children:(0,b.jsx)(i.Calendar,{className:"w-5 h-5 text-pink-600"})}),(0,b.jsx)("p",{className:"text-xs text-gray-600 mb-1",children:"en"===o?"Avg Order Value":"Nilai Pesan Rata"}),(0,b.jsx)("h3",{className:"text-xl font-bold text-gray-900",children:J(t.avgOrderValue).substring(0,15)})]})]}),(0,b.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[v.length>0&&(0,b.jsxs)("div",{className:"bg-white rounded-xl p-6 border border-gray-100 shadow-sm",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-5",children:[(0,b.jsx)(j.DollarSign,{className:"w-5 h-5 text-[var(--color-accent)]"}),(0,b.jsx)("h3",{className:"text-lg font-bold text-gray-900",children:"en"===o?"Top Spenders":"Pembeli Terbanyak"})]}),(0,b.jsx)("div",{className:"space-y-3",children:v.map((a,c)=>(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gradient-to-r from-blue-50 to-blue-0 rounded-lg hover:shadow-md transition-all border border-blue-100",children:[(0,b.jsx)("div",{className:"flex-1",children:(0,b.jsxs)("div",{className:"flex items-center gap-3",children:[(0,b.jsx)("span",{className:"text-sm font-bold bg-[var(--color-accent)] text-white w-7 h-7 rounded-full flex items-center justify-center",children:c+1}),(0,b.jsxs)("div",{children:[(0,b.jsx)("p",{className:"font-semibold text-gray-900",children:a.customerName}),(0,b.jsxs)("p",{className:"text-xs text-gray-600",children:[a.totalOrders," ","en"===o?"orders":"pesanan"," • ","en"===o?"Avg":"Rata",": ",J(a.avgOrderValue)]})]})]})}),(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsx)("p",{className:"text-sm font-bold text-[var(--color-accent)]",children:J(a.totalSpent)}),(0,b.jsx)("p",{className:"text-xs text-gray-500",children:a.favoriteItem})]})]},a.customerId))})]}),x.length>0&&(0,b.jsxs)("div",{className:"bg-white rounded-xl p-6 border border-gray-100 shadow-sm",children:[(0,b.jsxs)("div",{className:"flex items-center gap-2 mb-5",children:[(0,b.jsx)(f.Users,{className:"w-5 h-5 text-[var(--color-accent)]"}),(0,b.jsx)("h3",{className:"text-lg font-bold text-gray-900",children:"en"===o?"New Customers":"Pelanggan Baru"})]}),(0,b.jsx)("div",{className:"space-y-3",children:x.map((a,c)=>(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gradient-to-r from-green-50 to-green-0 rounded-lg hover:shadow-md transition-all border border-green-100",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"font-semibold text-gray-900",children:a.customerName}),(0,b.jsxs)("p",{className:"text-xs text-gray-600",children:[K(a.lastOrder)," • ",a.totalOrders," ","en"===o?"order":"pesanan"]})]}),(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsx)("p",{className:"text-sm font-bold text-green-600",children:J(a.totalSpent)}),(0,b.jsx)("p",{className:"text-xs text-gray-500",children:a.favoriteItem})]})]},a.customerId))})]}),z.length>0&&(0,b.jsxs)("div",{className:"bg-white rounded-xl p-6 border border-gray-100 shadow-sm",children:[(0,b.jsx)("div",{className:"flex items-center justify-between mb-5",children:(0,b.jsxs)("div",{className:"flex items-center gap-2",children:[(0,b.jsx)(h.Award,{className:"w-5 h-5 text-[var(--color-accent)]"}),(0,b.jsx)("h3",{className:"text-lg font-bold text-gray-900",children:"en"===o?"Loyal Customers":"Pelanggan Setia"}),t.repeatingCustomers>5&&(0,b.jsxs)("span",{className:"text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded",children:[t.repeatingCustomers," ","total"]})]})}),(0,b.jsx)("div",{className:"space-y-3 mb-4",children:z.map((a,c)=>(0,b.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gradient-to-r from-purple-50 to-purple-0 rounded-lg hover:shadow-md transition-all border border-purple-100",children:[(0,b.jsxs)("div",{className:"flex-1",children:[(0,b.jsx)("p",{className:"font-semibold text-gray-900",children:a.customerName}),(0,b.jsxs)("p",{className:"text-xs text-gray-600",children:[a.totalOrders," ","en"===o?"orders":"pesanan"," • ",J(a.avgOrderValue),"/pesanan"]})]}),(0,b.jsxs)("div",{className:"text-right",children:[(0,b.jsx)("p",{className:"text-lg font-bold text-purple-600",children:"⭐"}),(0,b.jsx)("p",{className:"text-xs text-gray-500",children:J(a.totalSpent)})]})]},a.customerId))}),t.repeatingCustomers>5&&(0,b.jsxs)("button",{onClick:()=>{G("loyal"),E(!0)},className:"w-full py-2 text-center text-sm text-purple-600 hover:bg-purple-50 rounded-lg transition-colors font-medium",children:["en"===o?"View All":"Lihat Semua"," →"]})]})]})]})}),D&&(0,b.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,b.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col",children:[(0,b.jsxs)("div",{className:"flex items-center justify-between px-8 py-6 border-b border-gray-200",children:[(0,b.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"en"===o?"All Customers":"Semua Pelanggan"}),(0,b.jsx)("button",{onClick:()=>E(!1),className:"text-gray-500 hover:text-gray-700 transition-colors",children:(0,b.jsx)(l.X,{className:"w-6 h-6"})})]}),(0,b.jsxs)("div",{className:"flex gap-4 px-8 py-4 border-b border-gray-200 bg-gray-50",children:[(0,b.jsxs)("button",{onClick:()=>G("all"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${"all"===F?"bg-blue-100 text-blue-700":"text-gray-600 hover:text-gray-900"}`,children:["en"===o?"All":"Semua"," (",B.length,")"]}),(0,b.jsxs)("button",{onClick:()=>G("top"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${"top"===F?"bg-blue-100 text-blue-700":"text-gray-600 hover:text-gray-900"}`,children:["en"===o?"Top Spenders":"Pembeli Terbanyak"," (",B.filter(a=>a.totalOrders>=1).length,")"]}),(0,b.jsxs)("button",{onClick:()=>G("loyal"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${"loyal"===F?"bg-blue-100 text-blue-700":"text-gray-600 hover:text-gray-900"}`,children:["en"===o?"Loyal":"Setia"," (",B.filter(a=>a.totalOrders>=3).length,")"]})]}),(0,b.jsx)("div",{className:"flex-1 overflow-y-auto px-8 py-6",children:(0,b.jsx)("div",{className:"space-y-4",children:("all"===F?B.filter(a=>!a.customerName.startsWith("Customer ")):"loyal"===F?B.filter(a=>a.totalOrders>=3&&!a.customerName.startsWith("Customer ")).sort((a,b)=>b.totalOrders-a.totalOrders):B.filter(a=>!a.customerName.startsWith("Customer "))).map((a,c)=>(0,b.jsxs)("div",{className:"p-5 border border-gray-200 rounded-lg hover:shadow-md transition-all hover:border-gray-300 cursor-pointer",children:[(0,b.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,b.jsxs)("div",{children:[(0,b.jsx)("h3",{className:"text-lg font-bold text-gray-900",children:a.customerName}),(0,b.jsxs)("p",{className:"text-xs text-gray-600 mt-1",children:["en"===o?"Customer ID":"ID Pelanggan",": ",a.customerId?.substring(0,12)]})]}),(0,b.jsx)("span",{className:"text-2xl font-bold text-blue-600",children:J(a.totalSpent)})]}),(0,b.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,b.jsxs)("div",{className:"bg-blue-50 p-3 rounded-lg",children:[(0,b.jsx)("p",{className:"text-xs text-gray-600 mb-1",children:"en"===o?"Total Orders":"Total Pesanan"}),(0,b.jsx)("p",{className:"text-xl font-bold text-blue-600",children:a.totalOrders})]}),(0,b.jsxs)("div",{className:"bg-green-50 p-3 rounded-lg",children:[(0,b.jsx)("p",{className:"text-xs text-gray-600 mb-1",children:"en"===o?"Avg Order":"Pesanan Rata"}),(0,b.jsx)("p",{className:"text-lg font-bold text-green-600",children:J(a.avgOrderValue)})]}),(0,b.jsxs)("div",{className:"bg-purple-50 p-3 rounded-lg",children:[(0,b.jsx)("p",{className:"text-xs text-gray-600 mb-1",children:"en"===o?"Last Order":"Pesanan Terakhir"}),(0,b.jsx)("p",{className:"text-sm font-semibold text-purple-600",children:K(a.lastOrder)})]}),(0,b.jsxs)("div",{className:"bg-orange-50 p-3 rounded-lg",children:[(0,b.jsx)("p",{className:"text-xs text-gray-600 mb-1",children:"en"===o?"Favorite Item":"Item Favorit"}),(0,b.jsx)("p",{className:"text-sm font-semibold text-orange-600 truncate",children:a.favoriteItem})]})]})]},a.customerId))})}),(0,b.jsx)("div",{className:"px-8 py-4 border-t border-gray-200 flex justify-end",children:(0,b.jsx)("button",{onClick:()=>E(!1),className:"px-6 py-2 bg-gray-200 text-gray-900 rounded-lg font-medium hover:bg-gray-300 transition-colors",children:"en"===o?"Close":"Tutup"})})]})})]})}a.s(["default",()=>n])}];

//# sourceMappingURL=src_app_dashboard_customers_page_tsx_c419ee53._.js.map