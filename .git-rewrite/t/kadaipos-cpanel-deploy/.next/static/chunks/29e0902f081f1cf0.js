(globalThis.TURBOPACK||(globalThis.TURBOPACK=[])).push(["object"==typeof document?document.currentScript:void 0,12426,e=>{"use strict";let t=(0,e.i(75254).default)("dollar-sign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);e.s(["DollarSign",()=>t],12426)},87316,e=>{"use strict";let t=(0,e.i(75254).default)("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);e.s(["Calendar",()=>t],87316)},42009,e=>{"use strict";let t=(0,e.i(75254).default)("award",[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]]);e.s(["Award",()=>t],42009)},69322,e=>{"use strict";var t=e.i(43476),s=e.i(71645),a=e.i(18566),r=e.i(11795),l=e.i(61911),n=e.i(25652),d=e.i(42009),i=e.i(87316),o=e.i(12426),c=e.i(1928),m=e.i(37727),x=e.i(44674);function u(){let e=(0,a.useRouter)(),u=(0,r.createClient)(),{language:g}=(0,x.useLanguage)(),[h,p]=(0,s.useState)(!0),[b,j]=(0,s.useState)(null),[N,y]=(0,s.useState)({totalCustomers:0,activeCustomers:0,totalRevenue:0,avgOrderValue:0,repeatingCustomers:0,repeatingRate:0}),[f,v]=(0,s.useState)([]),[w,O]=(0,s.useState)([]),[S,C]=(0,s.useState)([]),[I,D]=(0,s.useState)([]),[k,T]=(0,s.useState)(!1),[_,P]=(0,s.useState)("all");async function A(){if(b){p(!0);try{let e=new Date,t=new Date(e);t.setDate(e.getDate()-30);let{data:s}=await u.from("orders").select("*, order_items(*)").eq("restaurant_id",b.id).eq("payment_status","paid").gte("paid_at",t.toISOString());if(!s)return void p(!1);let a=new Set(s.map(e=>e.customer_id||e.id)).size,r=new Date(e);r.setDate(e.getDate()-7);let l=s.filter(e=>new Date(e.paid_at)>=r),n=new Set(l.map(e=>e.customer_id||e.id)).size,d={};s.forEach(e=>{let t=e.customer_id||e.id,s=e.customer_name?.trim()||`Customer ${t?.substring(0,8)}`;d[t]||(d[t]={id:e.id,customerId:t,customerName:s,totalOrders:0,totalSpent:0,lastOrder:e.paid_at,items:[]}),e.customer_name?.trim()&&!d[t].customerName.startsWith("Customer ")&&(d[t].customerName=e.customer_name.trim()),d[t].totalOrders+=1,d[t].totalSpent+=e.total||0,d[t].lastOrder=new Date(e.paid_at)>new Date(d[t].lastOrder)?e.paid_at:d[t].lastOrder,e.order_items?.forEach(e=>{let s=e.item_name||e.name;d[t].items.push(s)})});let i=Object.values(d).reduce((e,t)=>e+t.totalSpent,0),o=i/s.length,c=Object.values(d).filter(e=>e.totalOrders>1).length,m=a>0?c/a*100:0,x=Object.values(d).map(e=>({id:e.id,customerId:e.customerId,customerName:e.customerName,totalOrders:e.totalOrders,totalSpent:e.totalSpent,lastOrder:e.lastOrder,avgOrderValue:e.totalSpent/e.totalOrders,favoriteItem:R(e.items)})).sort((e,t)=>t.totalSpent-e.totalSpent).slice(0,5),g=Object.values(d).filter(e=>new Date(e.lastOrder)>=r).sort((e,t)=>new Date(t.lastOrder).getTime()-new Date(e.lastOrder).getTime()).slice(0,5).map(e=>({id:e.id,customerId:e.customerId,customerName:e.customerName,totalOrders:e.totalOrders,totalSpent:e.totalSpent,lastOrder:e.lastOrder,avgOrderValue:e.totalSpent/e.totalOrders,favoriteItem:R(e.items)})),h=Object.values(d).filter(e=>e.totalOrders>=3).sort((e,t)=>t.totalOrders-e.totalOrders).map(e=>({id:e.id,customerId:e.customerId,customerName:e.customerName,totalOrders:e.totalOrders,totalSpent:e.totalSpent,lastOrder:e.lastOrder,avgOrderValue:e.totalSpent/e.totalOrders,favoriteItem:R(e.items)})),j=Object.values(d).map(e=>({id:e.id,customerId:e.customerId,customerName:e.customerName,totalOrders:e.totalOrders,totalSpent:e.totalSpent,lastOrder:e.lastOrder,avgOrderValue:e.totalSpent/e.totalOrders,favoriteItem:R(e.items)})).sort((e,t)=>t.totalSpent-e.totalSpent);y({totalCustomers:a,activeCustomers:n,totalRevenue:i,avgOrderValue:Math.round(o),repeatingCustomers:c,repeatingRate:Math.round(m)}),v(x),O(g),C(h.slice(0,5)),D(j)}catch(e){console.error("Error loading customer data:",e)}finally{p(!1)}}}function R(e){if(0===e.length)return"-";let t={};return e.forEach(e=>{t[e]=(t[e]||0)+1}),Object.entries(t).sort((e,t)=>t[1]-e[1])[0][0]}function V(e){return new Intl.NumberFormat("id-ID",{style:"currency",currency:"IDR",minimumFractionDigits:0,maximumFractionDigits:0}).format(e)}function L(e){return new Date(e).toLocaleDateString("en"===g?"en-US":"id-ID")}return(0,s.useEffect)(()=>{!async function(){let{data:{user:t}}=await u.auth.getUser();if(!t)return e.push("/login");let{data:s}=await u.from("restaurants").select("*").eq("owner_id",t.id);if(!s||0===s.length)return e.push("/dashboard");let a=localStorage.getItem("selected_restaurant_id");if(a){let e=s.find(e=>e.id===a);e?j(e):j(s[0])}else j(s[0])}()},[]),(0,s.useEffect)(()=>{b&&A()},[b]),(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"p-8 mb-8 flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"en"===g?"Customers":"Pelanggan"}),(0,t.jsx)("p",{className:"text-gray-600",children:"en"===g?"Customer insights and analytics":"Wawasan dan analitik pelanggan"})]}),(0,t.jsxs)("button",{onClick:()=>T(!0),className:"flex items-center gap-2 px-6 py-3 bg-[var(--color-accent)] text-white rounded-xl font-semibold hover:bg-[var(--color-accent-hover)] transition-colors",children:[(0,t.jsx)(l.Users,{className:"w-5 h-5"}),"en"===g?"View All Customers":"Lihat Semua Pelanggan"]})]}),(0,t.jsx)("main",{className:"px-8 pb-8",children:h?(0,t.jsx)("div",{className:"flex items-center justify-center py-20",children:(0,t.jsx)("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-[var(--color-accent)]"})}):(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-4 mb-8",children:[(0,t.jsxs)("div",{className:"bg-white rounded-xl p-5 border border-gray-100 shadow-sm",children:[(0,t.jsx)("div",{className:"flex items-center justify-between mb-3",children:(0,t.jsx)(l.Users,{className:"w-5 h-5 text-blue-600"})}),(0,t.jsx)("p",{className:"text-xs text-gray-600 mb-1",children:"en"===g?"Total Customers":"Total Pelanggan"}),(0,t.jsx)("h3",{className:"text-2xl font-bold text-gray-900",children:N.totalCustomers})]}),(0,t.jsxs)("div",{className:"bg-white rounded-xl p-5 border border-gray-100 shadow-sm",children:[(0,t.jsx)("div",{className:"flex items-center justify-between mb-3",children:(0,t.jsx)(n.TrendingUp,{className:"w-5 h-5 text-green-600"})}),(0,t.jsx)("p",{className:"text-xs text-gray-600 mb-1",children:"en"===g?"Active (7 Days)":"Aktif (7 Hari)"}),(0,t.jsx)("h3",{className:"text-2xl font-bold text-gray-900",children:N.activeCustomers})]}),(0,t.jsxs)("div",{className:"bg-white rounded-xl p-5 border border-gray-100 shadow-sm",children:[(0,t.jsx)("div",{className:"flex items-center justify-between mb-3",children:(0,t.jsx)(d.Award,{className:"w-5 h-5 text-purple-600"})}),(0,t.jsx)("p",{className:"text-xs text-gray-600 mb-1",children:"en"===g?"Loyal Customers":"Pelanggan Setia"}),(0,t.jsx)("h3",{className:"text-2xl font-bold text-gray-900",children:N.repeatingCustomers})]}),(0,t.jsxs)("div",{className:"bg-white rounded-xl p-5 border border-gray-100 shadow-sm",children:[(0,t.jsx)("div",{className:"flex items-center justify-between mb-3",children:(0,t.jsx)(c.ShoppingCart,{className:"w-5 h-5 text-orange-600"})}),(0,t.jsx)("p",{className:"text-xs text-gray-600 mb-1",children:"en"===g?"Loyalty Rate":"Tingkat Loyalitas"}),(0,t.jsxs)("h3",{className:"text-2xl font-bold text-gray-900",children:[N.repeatingRate,"%"]})]}),(0,t.jsxs)("div",{className:"bg-white rounded-xl p-5 border border-gray-100 shadow-sm",children:[(0,t.jsx)("div",{className:"flex items-center justify-between mb-3",children:(0,t.jsx)(o.DollarSign,{className:"w-5 h-5 text-green-600"})}),(0,t.jsx)("p",{className:"text-xs text-gray-600 mb-1",children:"en"===g?"Total Revenue":"Total Pendapatan"}),(0,t.jsx)("h3",{className:"text-xl font-bold text-gray-900",children:V(N.totalRevenue).substring(0,15)})]}),(0,t.jsxs)("div",{className:"bg-white rounded-xl p-5 border border-gray-100 shadow-sm",children:[(0,t.jsx)("div",{className:"flex items-center justify-between mb-3",children:(0,t.jsx)(i.Calendar,{className:"w-5 h-5 text-pink-600"})}),(0,t.jsx)("p",{className:"text-xs text-gray-600 mb-1",children:"en"===g?"Avg Order Value":"Nilai Pesan Rata"}),(0,t.jsx)("h3",{className:"text-xl font-bold text-gray-900",children:V(N.avgOrderValue).substring(0,15)})]})]}),(0,t.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[f.length>0&&(0,t.jsxs)("div",{className:"bg-white rounded-xl p-6 border border-gray-100 shadow-sm",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-5",children:[(0,t.jsx)(o.DollarSign,{className:"w-5 h-5 text-[var(--color-accent)]"}),(0,t.jsx)("h3",{className:"text-lg font-bold text-gray-900",children:"en"===g?"Top Spenders":"Pembeli Terbanyak"})]}),(0,t.jsx)("div",{className:"space-y-3",children:f.map((e,s)=>(0,t.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gradient-to-r from-blue-50 to-blue-0 rounded-lg hover:shadow-md transition-all border border-blue-100",children:[(0,t.jsx)("div",{className:"flex-1",children:(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("span",{className:"text-sm font-bold bg-[var(--color-accent)] text-white w-7 h-7 rounded-full flex items-center justify-center",children:s+1}),(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-semibold text-gray-900",children:e.customerName}),(0,t.jsxs)("p",{className:"text-xs text-gray-600",children:[e.totalOrders," ","en"===g?"orders":"pesanan"," • ","en"===g?"Avg":"Rata",": ",V(e.avgOrderValue)]})]})]})}),(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsx)("p",{className:"text-sm font-bold text-[var(--color-accent)]",children:V(e.totalSpent)}),(0,t.jsx)("p",{className:"text-xs text-gray-500",children:e.favoriteItem})]})]},e.customerId))})]}),w.length>0&&(0,t.jsxs)("div",{className:"bg-white rounded-xl p-6 border border-gray-100 shadow-sm",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2 mb-5",children:[(0,t.jsx)(l.Users,{className:"w-5 h-5 text-[var(--color-accent)]"}),(0,t.jsx)("h3",{className:"text-lg font-bold text-gray-900",children:"en"===g?"New Customers":"Pelanggan Baru"})]}),(0,t.jsx)("div",{className:"space-y-3",children:w.map((e,s)=>(0,t.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gradient-to-r from-green-50 to-green-0 rounded-lg hover:shadow-md transition-all border border-green-100",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"font-semibold text-gray-900",children:e.customerName}),(0,t.jsxs)("p",{className:"text-xs text-gray-600",children:[L(e.lastOrder)," • ",e.totalOrders," ","en"===g?"order":"pesanan"]})]}),(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsx)("p",{className:"text-sm font-bold text-green-600",children:V(e.totalSpent)}),(0,t.jsx)("p",{className:"text-xs text-gray-500",children:e.favoriteItem})]})]},e.customerId))})]}),S.length>0&&(0,t.jsxs)("div",{className:"bg-white rounded-xl p-6 border border-gray-100 shadow-sm",children:[(0,t.jsx)("div",{className:"flex items-center justify-between mb-5",children:(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(0,t.jsx)(d.Award,{className:"w-5 h-5 text-[var(--color-accent)]"}),(0,t.jsx)("h3",{className:"text-lg font-bold text-gray-900",children:"en"===g?"Loyal Customers":"Pelanggan Setia"}),N.repeatingCustomers>5&&(0,t.jsxs)("span",{className:"text-xs bg-purple-100 text-purple-700 px-2 py-1 rounded",children:[N.repeatingCustomers," ","total"]})]})}),(0,t.jsx)("div",{className:"space-y-3 mb-4",children:S.map((e,s)=>(0,t.jsxs)("div",{className:"flex items-center justify-between p-4 bg-gradient-to-r from-purple-50 to-purple-0 rounded-lg hover:shadow-md transition-all border border-purple-100",children:[(0,t.jsxs)("div",{className:"flex-1",children:[(0,t.jsx)("p",{className:"font-semibold text-gray-900",children:e.customerName}),(0,t.jsxs)("p",{className:"text-xs text-gray-600",children:[e.totalOrders," ","en"===g?"orders":"pesanan"," • ",V(e.avgOrderValue),"/pesanan"]})]}),(0,t.jsxs)("div",{className:"text-right",children:[(0,t.jsx)("p",{className:"text-lg font-bold text-purple-600",children:"⭐"}),(0,t.jsx)("p",{className:"text-xs text-gray-500",children:V(e.totalSpent)})]})]},e.customerId))}),N.repeatingCustomers>5&&(0,t.jsxs)("button",{onClick:()=>{P("loyal"),T(!0)},className:"w-full py-2 text-center text-sm text-purple-600 hover:bg-purple-50 rounded-lg transition-colors font-medium",children:["en"===g?"View All":"Lihat Semua"," →"]})]})]})]})}),k&&(0,t.jsx)("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",children:(0,t.jsxs)("div",{className:"bg-white rounded-xl shadow-2xl w-full max-w-4xl max-h-[90vh] flex flex-col",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between px-8 py-6 border-b border-gray-200",children:[(0,t.jsx)("h2",{className:"text-2xl font-bold text-gray-900",children:"en"===g?"All Customers":"Semua Pelanggan"}),(0,t.jsx)("button",{onClick:()=>T(!1),className:"text-gray-500 hover:text-gray-700 transition-colors",children:(0,t.jsx)(m.X,{className:"w-6 h-6"})})]}),(0,t.jsxs)("div",{className:"flex gap-4 px-8 py-4 border-b border-gray-200 bg-gray-50",children:[(0,t.jsxs)("button",{onClick:()=>P("all"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${"all"===_?"bg-blue-100 text-blue-700":"text-gray-600 hover:text-gray-900"}`,children:["en"===g?"All":"Semua"," (",I.length,")"]}),(0,t.jsxs)("button",{onClick:()=>P("top"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${"top"===_?"bg-blue-100 text-blue-700":"text-gray-600 hover:text-gray-900"}`,children:["en"===g?"Top Spenders":"Pembeli Terbanyak"," (",I.filter(e=>e.totalOrders>=1).length,")"]}),(0,t.jsxs)("button",{onClick:()=>P("loyal"),className:`px-4 py-2 rounded-lg font-medium transition-colors ${"loyal"===_?"bg-blue-100 text-blue-700":"text-gray-600 hover:text-gray-900"}`,children:["en"===g?"Loyal":"Setia"," (",I.filter(e=>e.totalOrders>=3).length,")"]})]}),(0,t.jsx)("div",{className:"flex-1 overflow-y-auto px-8 py-6",children:(0,t.jsx)("div",{className:"space-y-4",children:("all"===_?I.filter(e=>!e.customerName.startsWith("Customer ")):"loyal"===_?I.filter(e=>e.totalOrders>=3&&!e.customerName.startsWith("Customer ")).sort((e,t)=>t.totalOrders-e.totalOrders):I.filter(e=>!e.customerName.startsWith("Customer "))).map((e,s)=>(0,t.jsxs)("div",{className:"p-5 border border-gray-200 rounded-lg hover:shadow-md transition-all hover:border-gray-300 cursor-pointer",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between mb-3",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("h3",{className:"text-lg font-bold text-gray-900",children:e.customerName}),(0,t.jsxs)("p",{className:"text-xs text-gray-600 mt-1",children:["en"===g?"Customer ID":"ID Pelanggan",": ",e.customerId?.substring(0,12)]})]}),(0,t.jsx)("span",{className:"text-2xl font-bold text-blue-600",children:V(e.totalSpent)})]}),(0,t.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,t.jsxs)("div",{className:"bg-blue-50 p-3 rounded-lg",children:[(0,t.jsx)("p",{className:"text-xs text-gray-600 mb-1",children:"en"===g?"Total Orders":"Total Pesanan"}),(0,t.jsx)("p",{className:"text-xl font-bold text-blue-600",children:e.totalOrders})]}),(0,t.jsxs)("div",{className:"bg-green-50 p-3 rounded-lg",children:[(0,t.jsx)("p",{className:"text-xs text-gray-600 mb-1",children:"en"===g?"Avg Order":"Pesanan Rata"}),(0,t.jsx)("p",{className:"text-lg font-bold text-green-600",children:V(e.avgOrderValue)})]}),(0,t.jsxs)("div",{className:"bg-purple-50 p-3 rounded-lg",children:[(0,t.jsx)("p",{className:"text-xs text-gray-600 mb-1",children:"en"===g?"Last Order":"Pesanan Terakhir"}),(0,t.jsx)("p",{className:"text-sm font-semibold text-purple-600",children:L(e.lastOrder)})]}),(0,t.jsxs)("div",{className:"bg-orange-50 p-3 rounded-lg",children:[(0,t.jsx)("p",{className:"text-xs text-gray-600 mb-1",children:"en"===g?"Favorite Item":"Item Favorit"}),(0,t.jsx)("p",{className:"text-sm font-semibold text-orange-600 truncate",children:e.favoriteItem})]})]})]},e.customerId))})}),(0,t.jsx)("div",{className:"px-8 py-4 border-t border-gray-200 flex justify-end",children:(0,t.jsx)("button",{onClick:()=>T(!1),className:"px-6 py-2 bg-gray-200 text-gray-900 rounded-lg font-medium hover:bg-gray-300 transition-colors",children:"en"===g?"Close":"Tutup"})})]})})]})}e.s(["default",()=>u])}]);